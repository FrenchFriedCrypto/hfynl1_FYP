<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Transaction Costs: Dual vs Multicoin Pool Hops</title>
  <!-- Include Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Navigation bar styled as inline buttons */
    .navbar {
      text-align: center;
      margin-bottom: 20px;
    }
    .navbar a {
      display: inline-block;
      margin: 0 5px;
      padding: 10px 15px;
      text-decoration: none;
      color: #333;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .navbar a:hover {
      background-color: #ddd;
    }
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 1000px; margin: 0 auto; text-align: center; }
    .chart-container { width: 950px; margin: 0 auto 50px; }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="navbar">
    <a href="token_slippage.html">Slippage</a>
    <a href="token_crash_base.html">Crash</a>
    <a href="token_hop.html">Hop</a>
    <a href="token_hop_one.html">Hop Pool</a>
    <a href="token_mev.html">MEV</a>
    <a href="token_crash_equal.html">Crash Adj</a>
    <a href="captial_manage.html">Capital (3)</a>
    <a href="captial_manage_4.html">Capital (4)</a>
    <a href="captial_manage_5.html">Capital (5)</a>
    <a href="captial_manage_6.html">Capital (6)</a>
    <a href="captial_manage_comparison.html">$ Comparison</a>
  </div>
  <div class="container">
    <h2>Transaction Costs Simulation (Swap Fees)</h2>
    <p>
      Every pool hop charges a 0.3% fee. In the dual token pool the user swaps through 1–5 hops (compounding the fee),
      whereas the multicoin pool requires only one hop. All pools start with a 1000:1000 reserve and the user swaps 100 tokens.
      The bars below show the final number of target tokens received, and the overlaid line represents the effective fee –
      the percentage loss versus an ideal 1:1 output (100 tokens).
    </p>

    <!-- Dual Token Pool Chart -->
    <div class="chart-container">
      <h3>Dual Token Pool (Multiple Hops)</h3>
      <canvas id="dualPoolChart"></canvas>
    </div>

    <!-- Multicoin Pool Chart -->
    <div class="chart-container">
      <h3>Multicoin Pool (Single Hop)</h3>
      <canvas id="multiPoolChart"></canvas>
    </div>
  </div>

  <script>
    // Swap function per hop with fee.
    // Input x: tokens to swap.
    // Each pool has reserves 1000:1000 and charges a 0.3% fee.
    // Output is computed using the constant-product formula.
    function swapOutput(x) {
      const feeFactor = 0.997; // after 0.3% fee
      const effectiveInput = x * feeFactor;
      const output = (effectiveInput * 1000) / (1000 + effectiveInput);
      return output;
    }

    // The user intends to swap 100 tokens.
    const initialSwap = 100;

    // --- Dual Token Pool Simulation (1 to 5 hops) ---
    const hops = [1, 2, 3, 4, 5];
    const dualOutputs = [];
    hops.forEach(hopCount => {
      let amount = initialSwap;
      for (let i = 0; i < hopCount; i++) {
        amount = swapOutput(amount);
      }
      dualOutputs.push(amount);
    });

    // --- Multicoin Pool Simulation (Single-Hop) ---
    const multiOutput = swapOutput(initialSwap);

    // --- Compute Effective Transaction Fee Percentage ---
    // Expected output is 100 tokens (1:1). So fee (%) = ((100 - actual)/100)*100 = 100 - actual.
    const dualFeePercentages = dualOutputs.map(output => 100 - output);
    const multiFeePercentage = 100 - multiOutput;

    // ---------------------------
    // Create the Dual Pool Chart
    // ---------------------------
    const ctxDual = document.getElementById('dualPoolChart').getContext('2d');
    const dualPoolChart = new Chart(ctxDual, {
      type: 'bar',
      data: {
        labels: hops.map(h => h + " Hop" + (h > 1 ? "s" : "")),
        datasets: [
          {
            label: 'Target Tokens Received',
            data: dualOutputs,
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            yAxisID: 'y',
          },
          {
            type: 'line',
            label: 'Transaction Fee (%)',
            data: dualFeePercentages,
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            yAxisID: 'y1',
            tension: 0.2,
            fill: false,
            pointRadius: 4,
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Dual Token Pool: Output vs. Number of Hops'
          },
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Number of Pool Hops'
            }
          },
          y: {
            type: 'linear',
            position: 'left',
            title: {
              display: true,
              text: 'Target Tokens Received'
            },
            beginAtZero: true,
          },
          y1: {
            type: 'linear',
            position: 'right',
            title: {
              display: true,
              text: 'Transaction Fee (%)'
            },
            grid: {
              drawOnChartArea: false,
            },
            beginAtZero: true,
          }
        }
      }
    });

    // ------------------------------
    // Create the Multicoin Pool Chart
    // ------------------------------
    const ctxMulti = document.getElementById('multiPoolChart').getContext('2d');
    const multiPoolChart = new Chart(ctxMulti, {
      type: 'bar',
      data: {
        labels: ['1 Hop'],
        datasets: [
          {
            label: 'Target Tokens Received',
            data: [multiOutput],
            backgroundColor: 'rgba(255, 159, 64, 0.7)',
            yAxisID: 'y',
          },
          {
            type: 'line',
            label: 'Transaction Fee (%)',
            data: [multiFeePercentage],
            borderColor: 'rgba(153, 102, 255, 1)',
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            yAxisID: 'y1',
            tension: 0.2,
            fill: false,
            pointRadius: 4,
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Multicoin Pool: Output (Single-Hop)'
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Number of Pool Hops'
            }
          },
          y: {
            type: 'linear',
            position: 'left',
            title: {
              display: true,
              text: 'Target Tokens Received'
            },
            beginAtZero: true,
          },
          y1: {
            type: 'linear',
            position: 'right',
            title: {
              display: true,
              text: 'Transaction Fee (%)'
            },
            grid: {
              drawOnChartArea: false,
            },
            beginAtZero: true,
          }
        }
      }
    });
  </script>
</body>
</html>
